<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>簡易黑白棋（Othello）</title>
    <style>
        :root {
            --cell: 54px;
        }

        body {
            font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
            margin: 0;
            padding: 24px;
            background: #0f172a;
            color: #e2e8f0;
        }

        .wrap {
            max-width: 920px;
            margin: 0 auto;
            display: grid;
            gap: 16px;
            grid-template-columns: 1fr;
        }

        h1 {
            font-size: 20px;
            margin: 0 0 8px;
        }

        .panel {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 14px;
            padding: 14px;
        }

        .top {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
        }

        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .pill {
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
            font-size: 14px;
        }

        .btns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            cursor: pointer;
            border-radius: 12px;
            padding: 9px 12px;
            border: 1px solid rgba(255,255,255,0.18);
            background: rgba(255,255,255,0.08);
            color: #e2e8f0;
        }

            button:hover {
                background: rgba(255,255,255,0.12);
            }

            button:active {
                transform: translateY(1px);
            }

        .boardWrap {
            display: flex;
            justify-content: center;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, var(--cell));
            grid-template-rows: repeat(8, var(--cell));
            gap: 2px;
            background: rgba(255,255,255,0.08);
            padding: 10px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.12);
            user-select: none;
            touch-action: manipulation;
        }

        .cell {
            width: var(--cell);
            height: var(--cell);
            background: #166534;
            border-radius: 10px;
            position: relative;
            outline: 1px solid rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }

            .cell:hover {
                filter: brightness(1.05);
            }

        .disc {
            width: calc(var(--cell) * 0.68);
            height: calc(var(--cell) * 0.68);
            border-radius: 50%;
            box-shadow: inset 0 0 0 2px rgba(255,255,255,0.12), 0 10px 18px rgba(0,0,0,0.35);
        }

        .black {
            background: radial-gradient(circle at 35% 30%, #64748b 0%, #111827 60%, #0b1220 100%);
        }

        .white {
            background: radial-gradient(circle at 35% 30%, #ffffff 0%, #e2e8f0 55%, #cbd5e1 100%);
        }

        .hint::after {
            content: "";
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(250,204,21,0.9);
            box-shadow: 0 0 0 3px rgba(250,204,21,0.22);
            position: absolute;
        }

        .msg {
            margin-top: 8px;
            opacity: 0.95;
            font-size: 14px;
            line-height: 1.4;
        }

        .legend {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            font-size: 14px;
            opacity: 0.95;
        }

        .turnDot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
            vertical-align: middle;
        }

        .kbd {
            font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
            padding: 2px 6px;
            border-radius: 8px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
        }

        @media (max-width: 520px) {
            :root {
                --cell: 42px;
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="panel">
            <div class="top">
                <div>
                    <h1>簡易黑白棋（Othello）</h1>
                    <div class="legend">
                        <span class="pill"><span class="turnDot" id="turnDot"></span>輪到：<b id="turnText"></b></span>
                        <span class="pill">黑：<b id="blackCount">2</b></span>
                        <span class="pill">白：<b id="whiteCount">2</b></span>
                        <span class="pill">合法手：<b id="moveCount">4</b></span>
                    </div>
                </div>
                <div class="btns">
                    <button id="toggleHints">隱藏提示</button>
                    <button id="passBtn">PASS（無路可走）</button>
                    <button id="resetBtn">重新開始</button>
                </div>
            </div>
            <div class="msg" id="msg">
                點選棋盤下子。黃色點是合法位置。快捷鍵：<span class="kbd">R</span> 重新開始、<span class="kbd">H</span> 顯示/隱藏提示
            </div>
        </div>

        <div class="boardWrap">
            <div class="board" id="board" aria-label="Othello board"></div>
        </div>
    </div>

    <script>
(() => {
  const N = 8;
  const EMPTY = 0, BLACK = 1, WHITE = 2;
  const dirs = [
    [-1,-1],[-1,0],[-1,1],
    [0,-1],        [0,1],
    [1,-1],[1,0],[1,1]
  ];

  const boardEl = document.getElementById("board");
  const msgEl = document.getElementById("msg");
  const blackCountEl = document.getElementById("blackCount");
  const whiteCountEl = document.getElementById("whiteCount");
  const moveCountEl  = document.getElementById("moveCount");
  const turnTextEl   = document.getElementById("turnText");
  const turnDotEl    = document.getElementById("turnDot");
  const passBtn      = document.getElementById("passBtn");
  const resetBtn     = document.getElementById("resetBtn");
  const toggleHintsBtn = document.getElementById("toggleHints");

  let board = [];
  let turn = BLACK;
  let showHints = true;

  function inBounds(r,c){ return r>=0 && r<N && c>=0 && c<N; }
  function other(p){ return p===BLACK ? WHITE : BLACK; }

  function initBoard(){
    board = Array.from({length:N}, () => Array(N).fill(EMPTY));
    // 初始四子（標準）
    board[3][3] = WHITE; board[3][4] = BLACK;
    board[4][3] = BLACK; board[4][4] = WHITE;
    turn = BLACK;
    render();
    say("黑先。");
  }

  function getFlips(r,c,p){
    if (board[r][c] !== EMPTY) return [];
    const opp = other(p);
    const flips = [];

    for (const [dr,dc] of dirs){
      let rr = r + dr, cc = c + dc;
      const line = [];
      while (inBounds(rr,cc) && board[rr][cc] === opp){
        line.push([rr,cc]);
        rr += dr; cc += dc;
      }
      if (line.length > 0 && inBounds(rr,cc) && board[rr][cc] === p){
        flips.push(...line);
      }
    }
    return flips;
  }

  function getLegalMoves(p){
    const moves = [];
    for (let r=0;r<N;r++){
      for (let c=0;c<N;c++){
        const flips = getFlips(r,c,p);
        if (flips.length) moves.push({r,c,flips});
      }
    }
    return moves;
  }

  function applyMove(r,c){
    const flips = getFlips(r,c,turn);
    if (!flips.length) return false;

    board[r][c] = turn;
    for (const [rr,cc] of flips) board[rr][cc] = turn;

    // 換手：若對手無棋可走，則維持；若雙方都無棋可走，結束
    const next = other(turn);
    const nextMoves = getLegalMoves(next);
    const curMovesAfter = getLegalMoves(turn);

    if (nextMoves.length > 0){
      turn = next;
      say(`${turn===BLACK?"黑":"白"}方輪到。`);
    } else {
      // 對手無路 → 仍由本方下（但要確認本方還有路）
      if (curMovesAfter.length > 0){
        say(`${next===BLACK?"黑":"白"}方無路可走，${turn===BLACK?"黑":"白"}方繼續。`);
      } else {
        // 雙方都無路：結束
        endGame();
      }
    }

    render();
    return true;
  }

  function countDiscs(){
    let b=0,w=0;
    for (let r=0;r<N;r++){
      for (let c=0;c<N;c++){
        if (board[r][c]===BLACK) b++;
        else if (board[r][c]===WHITE) w++;
      }
    }
    return {b,w};
  }

  function endGame(){
    const {b,w} = countDiscs();
    let res = "平手。";
    if (b>w) res = "黑勝！";
    else if (w>b) res = "白勝！";
    say(`遊戲結束：黑 ${b}，白 ${w}。${res}`);
  }

  function say(text){
    msgEl.textContent = text;
  }

  function render(){
    boardEl.innerHTML = "";
    const legal = getLegalMoves(turn);
    const legalSet = new Set(legal.map(m => `${m.r},${m.c}`));

    for (let r=0;r<N;r++){
      for (let c=0;c<N;c++){
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.dataset.r = r;
        cell.dataset.c = c;

        if (showHints && legalSet.has(`${r},${c}`)){
          cell.classList.add("hint");
        }

        const v = board[r][c];
        if (v !== EMPTY){
          const d = document.createElement("div");
          d.className = "disc " + (v===BLACK ? "black" : "white");
          cell.appendChild(d);
        }

        cell.addEventListener("click", () => {
          const rr = Number(cell.dataset.r);
          const cc = Number(cell.dataset.c);
          const ok = applyMove(rr,cc);
          if (!ok) {
            // 提示一次即可，不要太吵
            const moves = getLegalMoves(turn).length;
            say(`這裡不能下。${turn===BLACK?"黑":"白"}方合法手：${moves}`);
          }
        });

        boardEl.appendChild(cell);
      }
    }

    const {b,w} = countDiscs();
    blackCountEl.textContent = b;
    whiteCountEl.textContent = w;
    moveCountEl.textContent  = legal.length;

    turnTextEl.textContent = (turn===BLACK ? "黑" : "白");
    turnDotEl.style.background = (turn===BLACK ? "#111827" : "#e2e8f0");
    turnDotEl.style.boxShadow = "0 0 0 2px rgba(255,255,255,0.18)";

    // PASS 按鈕狀態：有合法手就不該按
    passBtn.disabled = legal.length > 0;

    // 如果輪到的人也沒合法手，理論上應已被 endGame() 或換手邏輯處理
    // 這裡只做保護：
    if (legal.length === 0){
      const oppMoves = getLegalMoves(other(turn)).length;
      if (oppMoves === 0) endGame();
    }
  }

  // Buttons
  passBtn.addEventListener("click", () => {
    const legal = getLegalMoves(turn);
    if (legal.length > 0){
      say("你還有合法手，不需要 PASS。");
      return;
    }
    const nxt = other(turn);
    const nxtMoves = getLegalMoves(nxt);
    if (nxtMoves.length === 0){
      endGame();
    } else {
      turn = nxt;
      say(`${turn===BLACK?"黑":"白"}方輪到。`);
      render();
    }
  });

  resetBtn.addEventListener("click", () => initBoard());

  toggleHintsBtn.addEventListener("click", () => {
    showHints = !showHints;
    toggleHintsBtn.textContent = showHints ? "隱藏提示" : "顯示提示";
    render();
  });

  // Shortcuts
  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "r") initBoard();
    if (k === "h") {
      showHints = !showHints;
      toggleHintsBtn.textContent = showHints ? "隱藏提示" : "顯示提示";
      render();
    }
  });

  // Start
  initBoard();
})();
    </script>
</body>
</html>